# ПОЯСНИТЕЛЬНАЯ ЗАПИСКА

## Система обмена знаниями "KnowledgeForKnowledgeLite"

**Разработчик:** [Ваше имя]  
**Дата:** 2024  
**Назначение проекта:** Дипломная/курсовая работа

---

## 1. Назначение разрабатываемой программы

### 1.1. Целевая аудитория

Разрабатываемая программа предназначена для **студентов высших учебных заведений**, которые хотят обмениваться знаниями и навыками на основе принципа бартера.

### 1.2. Проблема, которую решает система

В процессе обучения студенты сталкиваются с ситуациями, когда:
- Они хорошо знают один предмет (например, линейную алгебру), но испытывают трудности с другим (например, математическим анализом)
- Им нужна помощь в изучении определенной дисциплины, но они не могут оплатить услуги репетитора
- Они готовы помочь другим студентам своими знаниями в обмен на помощь в другой области

**Пример использования:**
Студент А хорошо знает линейную алгебру, но испытывает сложности с математическим анализом. Студент Б отлично разбирается в матанализе, но нуждается в помощи по линейной алгебре. Система позволяет им найти друг друга и обменяться знаниями: студент А помогает Б с линалом, а Б помогает А с матаном.

### 1.3. Как система будет использоваться

1. **Регистрация и создание профиля:**
   - Пользователь регистрируется в системе
   - Заполняет профиль с информацией о себе
   - Указывает свои навыки и уровень владения ими

2. **Добавление навыков:**
   - Пользователь добавляет навыки из каталога (например, "Линейная алгебра", "Программирование на Python")
   - Указывает свой уровень владения (Beginner, Intermediate, Advanced, Expert)
   - Может загрузить подтверждающие документы (дипломы, сертификаты, проекты)

3. **Верификация навыков:**
   - Администраторы проверяют загруженные документы
   - Подтверждают уровень владения навыком

4. **Публикация предложений и запросов:**
   - Пользователь может опубликовать **предложение** (Offer): "Готов помочь с линейной алгеброй"
   - Пользователь может опубликовать **запрос** (Request): "Нужна помощь с математическим анализом"

5. **Поиск и установление контакта:**
   - Система позволяет искать пользователей по навыкам
   - Пользователи могут просматривать профили и контактировать друг с другом
   - Обмен знаниями происходит вне системы (через указанные контакты)

---

## 2. Функциональные требования

На основе предназначения системы вытекают следующие функциональные требования:

### 2.1. Управление пользователями

**FR-1.** Система должна обеспечивать регистрацию новых пользователей с указанием логина (email) и пароля.

**FR-2.** Система должна обеспечивать аутентификацию пользователей по логину и паролю.

**FR-3.** Система должна поддерживать роли пользователей: обычный пользователь и администратор.

**FR-4.** Система должна поддерживать мягкое удаление пользователей (soft delete).

**FR-5.** Система должна хранить информацию о последнем входе пользователя в систему.

### 2.2. Управление профилями

**FR-6.** Система должна позволять пользователю создавать и редактировать свой профиль:
   - Полное имя
   - Дата рождения
   - Фотография профиля
   - Описание (до 3000 символов)
   - Контактная информация (email, телефон, социальные сети)

**FR-7.** Система должна позволять настраивать видимость контактной информации (публичная/приватная).

**FR-8.** Система должна отслеживать время последнего визита пользователя (LastSeenOnline).

### 2.3. Управление навыками

**FR-9.** Система должна поддерживать каталог навыков, организованный по категориям.

**FR-10.** Система должна позволять пользователю добавлять навыки из каталога к своему профилю.

**FR-11.** Система должна поддерживать стандартизированные уровни владения навыком (Beginner, Intermediate, Advanced, Expert).

**FR-12.** Система должна позволять указывать опыт работы со навыком в годах.

**FR-13.** Пользователь может иметь несколько навыков, каждый навык может иметь несколько пользователей.

**FR-14.** Система должна отслеживать верифицированные навыки пользователя.

### 2.4. Верификация навыков

**FR-15.** Система должна позволять пользователю загружать подтверждающие документы (дипломы, сертификаты, портфолио).

**FR-16.** Система должна поддерживать верификацию документов администраторами.

**FR-17.** Система должна хранить информацию о том, кто и когда верифицировал документ.

**FR-18.** Система должна поддерживать различные статусы документов: Pending, Approved, Rejected, Expired.

**FR-19.** Система должна поддерживать журнал запросов на верификацию.

### 2.5. Образование

**FR-20.** Система должна позволять пользователю указывать информацию об образовании:
   - Название учебного заведения
   - Специальность
   - Годы обучения
   - Уровень образования

### 2.6. Публикация предложений и запросов

**FR-21.** Система должна позволять пользователю публиковать **предложения** (готов помочь с навыком).

**FR-22.** Система должна позволять пользователю публиковать **запросы** (нужна помощь с навыком).

**FR-23.** Система должна поддерживать поиск предложений и запросов по навыкам.

**FR-24.** Система должна поддерживать различные статусы постов: Active, Closed, Cancelled, Expired.

**FR-25.** Система должна поддерживать мягкое удаление постов.

**FR-26.** Система должна отслеживать количество просмотров поста.

**FR-27.** Каждый пост связан ровно с одним пользователем (автором) и ровно с одним навыком.

### 2.7. Поиск и фильтрация

**FR-28.** Система должна позволять искать пользователей по навыкам.

**FR-29.** Система должна позволять фильтровать пользователей по уровню владения навыком.

**FR-30.** Система должна позволять искать активные предложения и запросы.

### 2.8. Аудит

**FR-31.** Система должна логировать все значимые действия пользователей (логин, добавление навыка, публикация поста, верификация).

---

## 3. Нефункциональные требования

### 3.1. Требования к пользователям

**Кто сможет использовать систему:**

1. **Студенты:**
   - Возраст: от 16 лет
   - Требования: наличие email-адреса, базовые навыки работы с веб-браузером
   - Образование: студенты вузов, колледжей, а также лица, получающие дополнительное образование

2. **Администраторы:**
   - Требования: назначение администратором существующим администратором
   - Права: верификация документов, модерация контента, управление каталогом навыков

3. **Гостевые пользователи:**
   - Могут просматривать публичные профили и активные предложения/запросы
   - Не могут создавать посты или добавлять навыки без регистрации

### 3.2. Технические требования

**NFR-1.** Система должна поддерживать не менее 10 000 зарегистрированных пользователей.

**NFR-2.** Время отклика системы на запрос поиска не должно превышать 2 секунды.

**NFR-3.** Система должна поддерживать одновременную работу не менее 100 пользователей.

**NFR-4.** Данные должны храниться в реляционной базе данных с поддержкой транзакций.

**NFR-5.** Пароли должны храниться в хэшированном виде (BCrypt/Argon2).

**NFR-6.** Система должна обеспечивать целостность данных через внешние ключи и ограничения.

**NFR-7.** Система должна поддерживать резервное копирование данных.

**NFR-8.** Система должна логировать все действия администраторов.

---

## 4. Предварительная схема базы данных

### 4.1. ER-диаграмма (текстовое представление)

```
┌──────────────┐
│   Accounts   │
│──────────────│
│ AccountID (PK)│
│ Login (UK)   │
│ PasswordHash │
│ IsAdmin      │
│ EmailConfirmed│
│ LastLoginAt  │
│ ...          │
└──────┬───────┘
       │ 1
       │
       │ 1
┌──────▼───────┐
│ UserProfiles │
│──────────────│
│ AccountID(PK)│
│ FullName     │
│ DateOfBirth  │
│ PhotoURL     │
│ Description  │
│ ...          │
└──────────────┘

┌──────────────┐       ┌──────────────┐
│   Accounts   │ 1    *│ UserContacts │
│              │◄──────│              │
└──────┬───────┘       └──────────────┘
       │ 1
       │
       │ *
┌──────▼──────────────┐
│    UserSkills       │
│─────────────────────│
│ AccountID (PK, FK)  │
│ SkillID (PK, FK)    │
│ SkillLevelID (FK)   │
│ IsVerified          │
│ ExperienceYears     │
└──────┬──────────────┘
       │ *
       │
       │ 1
┌──────▼──────────────┐
│   SkillsCatalog     │
│─────────────────────│
│ SkillID (PK)        │
│ SkillName           │
│ CategoryID (FK)     │
└──────┬──────────────┘
       │ *
       │
       │ 1
┌──────▼──────────────┐
│  SkillCategories    │
│─────────────────────│
│ CategoryID (PK)     │
│ Name                │
└─────────────────────┘

┌──────────────┐       ┌──────────────┐
│   Accounts   │ 1    *│  SkillPosts  │
│              │◄──────│              │
└──────┬───────┘       └──────┬───────┘
       │                      │ *
       │                      │
       │                      │ 1
       │              ┌───────▼──────────┐
       │              │  SkillsCatalog   │
       │              └──────────────────┘
       │
       │ 1
       │
       │ *
┌──────▼──────────────┐
│      Proofs         │
│─────────────────────│
│ ProofID (PK)        │
│ AccountID (FK)      │
│ SkillID (FK, NULL)  │
│ FileURL             │
│ Status              │
│ VerifiedBy (FK)     │
└─────────────────────┘

┌──────────────┐       ┌──────────────┐
│   Accounts   │ 1    *│  Education   │
│              │◄──────│              │
└──────────────┘       └──────────────┘

┌──────────────┐       ┌─────────────────────┐
│   Accounts   │ 1    *│ VerificationRequests│
│              │◄──────│                     │
└──────────────┘       └─────────────────────┘
```

### 4.2. Список сущностей и их атрибутов

#### 4.2.1. Accounts (Аккаунты)
- AccountID (PK)
- Login (UK)
- PasswordHash
- IsAdmin
- EmailConfirmed
- LastLoginAt
- PasswordUpdatedAt
- CreatedAt
- UpdatedAt
- DeletedAt (soft delete)

#### 4.2.2. UserProfiles (Профили пользователей)
- AccountID (PK, FK → Accounts)
- FullName
- DateOfBirth
- PhotoURL
- Description
- LastSeenOnline
- IsActive
- CreatedAt
- UpdatedAt

#### 4.2.3. UserContacts (Контакты)
- ContactID (PK)
- AccountID (FK → Accounts)
- ContactType
- ContactValue
- IsPublic
- DisplayOrder
- CreatedAt
- UpdatedAt

#### 4.2.4. SkillCategories (Категории навыков)
- CategoryID (PK)
- Name (UK)
- Description
- IconURL
- DisplayOrder
- IsActive
- CreatedAt
- UpdatedAt

#### 4.2.5. SkillsCatalog (Каталог навыков)
- SkillID (PK)
- SkillName
- CategoryID (FK → SkillCategories)
- Description
- IsActive
- CreatedAt
- UpdatedAt

#### 4.2.6. SkillLevels (Уровни навыков)
- LevelID (PK)
- Name (UK)
- Rank (UK)
- Description
- CreatedAt
- UpdatedAt

#### 4.2.7. UserSkills (Навыки пользователей)
- AccountID (PK, FK → Accounts)
- SkillID (PK, FK → SkillsCatalog)
- SkillLevelID (FK → SkillLevels)
- IsVerified
- VerifiedAt
- ExperienceYears
- CreatedAt
- UpdatedAt

#### 4.2.8. Education (Образование)
- EducationID (PK)
- AccountID (FK → Accounts)
- InstitutionName
- DegreeField
- YearStarted
- YearCompleted
- DegreeLevel
- IsCurrent
- CreatedAt
- UpdatedAt

#### 4.2.9. Proofs (Документы)
- ProofID (PK)
- AccountID (FK → Accounts)
- SkillID (FK → SkillsCatalog, NULL)
- EducationID (FK → Education, NULL)
- FileURL
- FileName
- FileSize
- MimeType
- Status
- VerifiedBy (FK → Accounts, NULL)
- VerifiedAt
- RejectionReason
- ExpiresAt
- CreatedAt
- UpdatedAt

#### 4.2.10. SkillPosts (Посты о навыках)
- PostID (PK)
- AccountID (FK → Accounts)
- SkillID (FK → SkillsCatalog)
- PostType (Offer/Request)
- Title
- Details
- Status
- ContactPreference
- ExpiresAt
- ViewsCount
- CreatedAt
- UpdatedAt
- DeletedAt (soft delete)

#### 4.2.11. VerificationRequests (Запросы на верификацию)
- RequestID (PK)
- AccountID (FK → Accounts)
- ProofID (FK → Proofs)
- RequestType
- Status
- RequestMessage
- ReviewNotes
- CreatedAt
- ReviewedBy (FK → Accounts, NULL)
- ReviewedAt
- UpdatedAt

#### 4.2.12. AuditLog (Журнал аудита)
- LogID (PK)
- ActorAccountID (FK → Accounts, NULL)
- Action
- EntityType
- EntityID
- Details (JSON)
- IPAddress
- UserAgent
- Result
- ErrorMessage
- CreatedAt

### 4.3. Связи между сущностями

1. **Accounts ↔ UserProfiles:** 1:1 (один аккаунт — один профиль)
2. **Accounts ↔ UserContacts:** 1:* (один аккаунт — много контактов)
3. **Accounts ↔ UserSkills:** 1:* (один пользователь — много навыков)
4. **Accounts ↔ SkillPosts:** 1:* (один пользователь — много постов)
5. **Accounts ↔ Education:** 1:* (один пользователь — много записей об образовании)
6. **Accounts ↔ Proofs:** 1:* (один пользователь — много документов)
7. **Accounts ↔ VerificationRequests:** 1:* (один пользователь — много запросов)
8. **SkillCategories ↔ SkillsCatalog:** 1:* (одна категория — много навыков)
9. **SkillsCatalog ↔ UserSkills:** 1:* (один навык — много пользователей)
10. **SkillsCatalog ↔ SkillPosts:** 1:* (один навык — много постов)
11. **SkillLevels ↔ UserSkills:** 1:* (один уровень — много пользователей)
12. **Proofs ↔ VerificationRequests:** 1:* (один документ — много запросов)

---

## 5. Текстовые ограничения на данные

На основе функциональных требований вытекают следующие ограничения:

### 5.1. Ограничения целостности

**OC-1.** Один аккаунт имеет ровно один профиль пользователя (UserProfile). Один профиль принадлежит ровно одному аккаунту.

**OC-2.** Один аккаунт может иметь 0 или более контактов (UserContacts). Каждый контакт принадлежит ровно одному аккаунту.

**OC-3.** Один пользователь (Account) может иметь 0 или более навыков (UserSkills). Один навык может принадлежать 0 или более пользователям (связь многие-ко-многим).

**OC-4.** Каждый навык пользователя (UserSkills) имеет ровно один уровень владения (SkillLevel). Один уровень может быть присвоен 0 или более навыкам пользователей.

**OC-5.** Один пост (SkillPost) принадлежит ровно одному пользователю (Account) и связан ровно с одним навыком (SkillsCatalog). Один пользователь может создать 0 или более постов. Один навык может быть упомянут в 0 или более постах.

**OC-6.** Один документ (Proof) принадлежит ровно одному пользователю (Account). Документ может быть связан с 0 или 1 навыком (SkillID может быть NULL) и с 0 или 1 записью об образовании (EducationID может быть NULL), но хотя бы одна из этих связей должна существовать.

**OC-7.** Одна категория навыков (SkillCategory) может содержать 0 или более навыков (SkillsCatalog). Один навык принадлежит ровно одной категории.

**OC-8.** Один запрос на верификацию (VerificationRequest) связан ровно с одним документом (Proof) и ровно с одним пользователем (Account). Один документ может иметь 0 или более запросов на верификацию.

### 5.2. Ограничения значений

**OC-9.** Логин (Accounts.Login) должен быть уникальным в системе.

**OC-10.** Название навыка (SkillsCatalog.SkillName) должно быть уникальным в пределах категории (UNIQUE(SkillName, CategoryID)).

**OC-11.** Уровень навыка (SkillLevels.Rank) должен быть уникальным (для корректной сортировки).

**OC-12.** Описание профиля (UserProfiles.Description) не должно превышать 3000 символов.

**OC-13.** Описание поста (SkillPosts.Details) не должно превышать 5000 символов.

**OC-14.** Год начала обучения (Education.YearStarted) должен быть в диапазоне от 1900 до 2100.

**OC-15.** Год окончания обучения (Education.YearCompleted) должен быть в диапазоне от 1900 до 2100, и если указан, то должен быть больше или равен году начала (YearCompleted >= YearStarted).

**OC-16.** Опыт работы со навыком (UserSkills.ExperienceYears) должен быть в диапазоне от 0 до 100 лет.

**OC-17.** Тип поста (SkillPosts.PostType) может иметь только значения 'Offer' или 'Request'.

**OC-18.** Статус поста (SkillPosts.Status) может иметь только значения 'Active', 'Closed', 'Cancelled', 'Expired'.

**OC-19.** Статус документа (Proofs.Status) может иметь только значения 'Pending', 'Approved', 'Rejected', 'Expired'.

### 5.3. Ограничения бизнес-логики

**OC-20.** Пользователь не может удалить навык из каталога (SkillsCatalog), если существуют активные посты, связанные с этим навыком (RESTRICT).

**OC-21.** Пользователь не может удалить категорию навыков, если в ней есть навыки (RESTRICT).

**OC-22.** Пользователь не может удалить уровень навыка, если есть пользователи с этим уровнем (RESTRICT).

**OC-23.** При удалении пользователя (Account) должны каскадно удаляться его профиль, контакты, навыки, посты, образование, документы и запросы на верификацию (CASCADE).

**OC-24.** При удалении навыка из каталога связь с документом должна обнуляться (SET NULL), но документ остается.

---

## 6. Функциональные и многозначные зависимости

### 6.1. Функциональные зависимости (FD)

#### Таблица Accounts:
- `AccountID → Login, PasswordHash, IsAdmin, EmailConfirmed, LastLoginAt, PasswordUpdatedAt, CreatedAt, UpdatedAt, DeletedAt`
- `Login → AccountID` (обратная зависимость из-за UNIQUE)

#### Таблица UserProfiles:
- `AccountID → FullName, DateOfBirth, PhotoURL, Description, LastSeenOnline, IsActive, CreatedAt, UpdatedAt`

#### Таблица UserContacts:
- `ContactID → AccountID, ContactType, ContactValue, IsPublic, DisplayOrder, CreatedAt, UpdatedAt`
- `AccountID, ContactType, ContactValue → ContactID` (предполагается уникальность комбинации для одного пользователя)

#### Таблица SkillCategories:
- `CategoryID → Name, Description, IconURL, DisplayOrder, IsActive, CreatedAt, UpdatedAt`
- `Name → CategoryID` (обратная зависимость из-за UNIQUE)

#### Таблица SkillsCatalog:
- `SkillID → SkillName, CategoryID, Description, IsActive, CreatedAt, UpdatedAt`
- `CategoryID, SkillName → SkillID` (обратная зависимость из-за UNIQUE(CategoryID, SkillName))

#### Таблица SkillLevels:
- `LevelID → Name, Rank, Description, CreatedAt, UpdatedAt`
- `Name → LevelID` (обратная зависимость из-за UNIQUE)
- `Rank → LevelID` (обратная зависимость из-за UNIQUE)

#### Таблица UserSkills:
- `AccountID, SkillID → SkillLevelID, IsVerified, VerifiedAt, ExperienceYears, CreatedAt, UpdatedAt`
- Это составной ключ, поэтому все неключевые атрибуты функционально зависят от него

#### Таблица Education:
- `EducationID → AccountID, InstitutionName, DegreeField, YearStarted, YearCompleted, DegreeLevel, IsCurrent, CreatedAt, UpdatedAt`

#### Таблица Proofs:
- `ProofID → AccountID, SkillID, EducationID, FileURL, FileName, FileSize, MimeType, Status, VerifiedBy, VerifiedAt, RejectionReason, ExpiresAt, CreatedAt, UpdatedAt`

#### Таблица SkillPosts:
- `PostID → AccountID, SkillID, PostType, Title, Details, Status, ContactPreference, ExpiresAt, ViewsCount, CreatedAt, UpdatedAt, DeletedAt`

#### Таблица VerificationRequests:
- `RequestID → AccountID, ProofID, RequestType, Status, RequestMessage, ReviewNotes, CreatedAt, ReviewedBy, ReviewedAt, UpdatedAt`

#### Таблица AuditLog:
- `LogID → ActorAccountID, Action, EntityType, EntityID, Details, IPAddress, UserAgent, Result, ErrorMessage, CreatedAt`

### 6.2. Многозначные зависимости (MVD)

В нормализованной схеме многозначные зависимости устранены через декомпозицию. Однако можно выделить следующие потенциальные MVD, которые были решены:

#### До нормализации (гипотетическая объединенная таблица UserData):

Если бы все данные пользователя хранились в одной таблице:
- `AccountID ↠ ContactType, ContactValue | SkillID, SkillLevelID | EducationID`

Это означало бы, что контакты, навыки и образование независимы друг от друга для одного пользователя.

**Решение:** Разделение на отдельные таблицы UserContacts, UserSkills, Education.

#### Для таблицы Proofs:

- `ProofID ↠ SkillID | EducationID` — документ может быть связан с навыком ИЛИ с образованием, но не с обоими одновременно.

**Решение:** Оба поля могут быть NULL, но не могут быть заполнены одновременно (требуется проверка на уровне приложения или CHECK-ограничение).

---

## 7. Нормализация схемы базы данных

### 7.1. Цель нормализации

Нормализация предназначена для:
- Устранения избыточности данных
- Предотвращения аномалий вставки, обновления и удаления
- Обеспечения целостности данных
- Упрощения поддержки базы данных

### 7.2. Процесс нормализации

#### Шаг 1: Первая нормальная форма (1NF)

**Требования:** Все атрибуты должны быть атомарными, не должно быть повторяющихся групп.

**Проверка схемы:**

✅ **Accounts, UserProfiles, SkillCategories, SkillsCatalog, SkillLevels** — все атрибуты атомарны.

✅ **UserContacts** — контакты вынесены в отдельную таблицу, что устраняет повторяющиеся группы (ContactType1, ContactValue1, ContactType2, ContactValue2...).

✅ **UserSkills** — навыки вынесены в отдельную таблицу, что устраняет повторяющиеся группы.

✅ **Education** — записи об образовании вынесены в отдельную таблицу.

✅ **SkillPosts** — все атрибуты атомарны.

**Вывод:** Схема соответствует 1NF.

#### Шаг 2: Вторая нормальная форма (2NF)

**Требования:** Таблица должна быть в 1NF, и все неключевые атрибуты должны полностью зависеть от всего составного ключа (если он есть).

**Проверка схемы:**

✅ **UserSkills (AccountID, SkillID)** — составной ключ. Все неключевые атрибуты (SkillLevelID, IsVerified, ExperienceYears) зависят от полного ключа. Нельзя определить уровень навыка только по AccountID или только по SkillID.

**Вывод:** Схема соответствует 2NF.

#### Шаг 3: Третья нормальная форма (3NF)

**Требования:** Таблица должна быть в 2NF, и не должно быть транзитивных зависимостей (неключевой атрибут зависит от другого неключевого атрибута).

**Проверка потенциальных транзитивных зависимостей:**

✅ **UserProfiles:** Все атрибуты зависят только от AccountID (ключ), транзитивных зависимостей нет.

✅ **SkillsCatalog:** Все атрибуты зависят от SkillID. CategoryID является внешним ключом, но не создает транзитивную зависимость (название категории хранится в SkillCategories, а не в SkillsCatalog).

✅ **UserSkills:** Все неключевые атрибуты зависят от полного ключа (AccountID, SkillID). SkillLevelID — внешний ключ, но не создает транзитивную зависимость (название уровня хранится в SkillLevels).

✅ **SkillPosts:** Все атрибуты зависят от PostID. AccountID и SkillID — внешние ключи, но не создают транзитивных зависимостей.

**Вывод:** Схема соответствует 3NF.

#### Шаг 4: Нормальная форма Бойса-Кодда (BCNF)

**Требования:** Таблица должна быть в 3NF, и каждая детерминанта (левая часть функциональной зависимости) должна быть потенциальным ключом.

**Проверка:**

✅ **Accounts:** Login является детерминантой (Login → AccountID) и является уникальным ключом (UK), что соответствует BCNF.

✅ **SkillCategories:** Name является детерминантой и является уникальным ключом, что соответствует BCNF.

✅ **SkillsCatalog:** (CategoryID, SkillName) является детерминантой и является составным уникальным ключом, что соответствует BCNF.

✅ **SkillLevels:** Name и Rank являются детерминантами и являются уникальными ключами, что соответствует BCNF.

**Вывод:** Схема соответствует BCNF.

#### Шаг 5: Четвертая нормальная форма (4NF)

**Требования:** Таблица должна быть в BCNF, и не должно быть нетривиальных многозначных зависимостей.

**Проверка:**

✅ Все многозначные зависимости устранены через декомпозицию:
- Контакты вынесены в UserContacts
- Навыки вынесены в UserSkills
- Образование вынесено в Education

**Вывод:** Схема соответствует 4NF.

### 7.3. Итоговый вывод по нормализации

Схема базы данных нормализована до **4NF** (четвертой нормальной формы), что означает:
- Устранены все аномалии обновления и удаления
- Минимизирована избыточность данных
- Обеспечена целостность данных
- Упрощена поддержка базы данных

---

## 8. Пример недонормализованной схемы и аномалий

### 8.1. Недонормализованная схема

Рассмотрим альтернативный вариант, где данные пользователя, его навыки и контакты хранятся в одной таблице:

```sql
CREATE TABLE UserData (
    AccountID BIGINT PRIMARY KEY,
    Login VARCHAR(100),
    FullName VARCHAR(150),
    Email VARCHAR(255),
    Phone VARCHAR(20),
    Telegram VARCHAR(100),
    Skill1 VARCHAR(100),
    Skill1Level VARCHAR(50),
    Skill2 VARCHAR(100),
    Skill2Level VARCHAR(50),
    Skill3 VARCHAR(100),
    Skill3Level VARCHAR(50)
);
```

**Проблемы этой схемы:**
1. Ограниченное количество навыков (только 3)
2. Избыточность при хранении контактов
3. Нарушение 1NF (повторяющиеся группы)

### 8.2. Более реалистичная недонормализованная схема

Рассмотрим схему, где навыки пользователя и информация о навыке хранятся вместе:

```sql
CREATE TABLE UserSkillsDenormalized (
    AccountID BIGINT,
    SkillID BIGINT,
    SkillName VARCHAR(100),
    CategoryID BIGINT,
    CategoryName VARCHAR(100),
    SkillLevelID BIGINT,
    LevelName VARCHAR(50),
    LevelRank INT,
    IsVerified BOOLEAN,
    ExperienceYears DECIMAL(3,1),
    PRIMARY KEY (AccountID, SkillID)
);
```

В нормализованной схеме эти данные разделены на таблицы:
- UserSkills (AccountID, SkillID, SkillLevelID, IsVerified, ExperienceYears)
- SkillsCatalog (SkillID, SkillName, CategoryID)
- SkillCategories (CategoryID, CategoryName)
- SkillLevels (LevelID, LevelName, LevelRank)

### 8.3. Аномалии недонормализованной схемы

#### Аномалия обновления (Update Anomaly)

**Сценарий:** Необходимо изменить название навыка "Python Programming" на "Python Development" для всех пользователей.

**В недонормализованной схеме:**
```sql
-- Нужно обновить все строки, где встречается этот навык
UPDATE UserSkillsDenormalized 
SET SkillName = 'Python Development' 
WHERE SkillName = 'Python Programming';
-- Если забыть обновить хотя бы одну строку, возникнет несогласованность данных
```

**Проблема:** 
- Необходимо обновить множество строк
- Высокий риск ошибки (можно пропустить некоторые записи)
- Избыточное использование ресурсов БД

**В нормализованной схеме:**
```sql
-- Обновляется только одна запись
UPDATE SkillsCatalog 
SET SkillName = 'Python Development' 
WHERE SkillID = 123;
-- Все связанные записи автоматически "увидят" новое название через JOIN
```

#### Аномалия вставки (Insertion Anomaly)

**Сценарий:** Необходимо добавить новый навык "Machine Learning" в каталог, но пока ни один пользователь его не имеет.

**В недонормализованной схеме:**
```sql
-- Невозможно вставить навык без привязки к пользователю
-- Нужно создать "фиктивного" пользователя или использовать NULL-значения
INSERT INTO UserSkillsDenormalized (SkillID, SkillName, CategoryID, CategoryName)
VALUES (999, 'Machine Learning', 5, 'Data Science');
-- Но AccountID не может быть NULL (это часть первичного ключа)
```

**Проблема:**
- Невозможно добавить навык в каталог без привязки к пользователю
- Нарушение логики данных

**В нормализованной схеме:**
```sql
-- Можно легко добавить навык в каталог
INSERT INTO SkillsCatalog (SkillID, SkillName, CategoryID)
VALUES (999, 'Machine Learning', 5);
-- Пользователи могут добавлять этот навык позже
```

#### Аномалия удаления (Deletion Anomaly)

**Сценарий:** Последний пользователь с навыком "COBOL" удаляет этот навык из своего профиля. Навык должен остаться в каталоге.

**В недонормализованной схеме:**
```sql
-- Удаление навыка пользователя
DELETE FROM UserSkillsDenormalized 
WHERE AccountID = 100 AND SkillID = 50;
-- Если это был последний пользователь с этим навыком, информация о навыке теряется
-- Навык "исчезает" из каталога, хотя должен оставаться доступным
```

**Проблема:**
- Потеря информации о навыке при удалении последней связи с пользователем
- Невозможность восстановления навыка без внешних источников

**В нормализованной схеме:**
```sql
-- Удаление навыка пользователя
DELETE FROM UserSkills 
WHERE AccountID = 100 AND SkillID = 50;
-- Навык остается в SkillsCatalog и доступен для других пользователей
```

#### Аномалия хранения (Storage Anomaly)

**Сценарий:** Пользователь имеет 10 навыков, каждый с полной информацией о категории и уровне.

**В недонормализованной схеме:**
- Каждая строка дублирует название категории, название уровня, ранг уровня
- Если категория "Programming" упоминается 1000 раз у разных пользователей, её название хранится 1000 раз
- Избыточное использование дискового пространства

**В нормализованной схеме:**
- Название категории хранится один раз в SkillCategories
- Название уровня хранится один раз в SkillLevels
- Экономия дискового пространства и обеспечение согласованности данных

### 8.4. Вывод

Нормализованная схема устраняет все перечисленные аномалии:
- ✅ Обновление данных происходит в одном месте
- ✅ Можно добавлять сущности независимо от связей
- ✅ Удаление связи не приводит к потере информации о сущности
- ✅ Минимизирована избыточность данных

---

## 9. Преобразование нормализованной схемы в SQL DDL

> **Примечание:** Полный SQL DDL скрипт вынесен в отдельный файл:
> `KnowledgeForKnowledgeLite/Scripts/00_init_database_postgresql.sql`
>
> См. файл для полного скрипта создания всех таблиц базы данных, индексов, ограничений целостности и заполнения справочных данных.

SQL DDL скрипт включает:

1. Создание всех таблиц с полным определением полей
2. Первичные и внешние ключи для обеспечения целостности данных
3. Индексы для оптимизации производительности
4. Ограничения (CHECK) для проверки значений данных
5. Заполнение справочных данных (уровни навыков, категории, примеры навыков)

---

## 10. SQL DML запросы, реализующие функциональные требования

> **Примечание:** Все SQL DML запросы вынесены в отдельный файл:
> `KnowledgeForKnowledgeLite/Scripts/02_dml_queries_postgresql.sql`
>
> См. файл для всех SQL DML запросов, реализующих функциональные требования системы.

---

Раздел включает DML запросы для следующих функциональных требований:

### 10.1. Управление пользователями (FR-1, FR-2, FR-4, FR-5)
- FR-1: Регистрация нового пользователя
- FR-2: Аутентификация пользователя
- FR-5: Обновление времени последнего входа
- FR-4: Мягкое удаление пользователя

### 10.2. Управление профилями (FR-6, FR-7, FR-8)
- FR-6: Создание/редактирование профиля
- FR-7: Добавление контакта с настройкой видимости
- FR-8: Обновление времени последнего визита

### 10.3. Управление навыками (FR-9, FR-10, FR-11, FR-12, FR-13)
- FR-10: Добавление навыка пользователю
- FR-13: Получение всех навыков пользователя

### 10.4. Верификация навыков (FR-15, FR-16, FR-17, FR-18)
- FR-15: Загрузка подтверждающего документа
- FR-16: Верификация документа администратором
- FR-17: Получение информации о верификаторе

### 10.5. Образование (FR-20)
- FR-20: Добавление информации об образовании

### 10.6. Публикация предложений и запросов (FR-21, FR-22, FR-23, FR-24)
- FR-21: Публикация предложения (Offer)
- FR-22: Публикация запроса (Request)
- FR-23: Поиск предложений и запросов по навыку
- FR-24: Изменение статуса поста

### 10.7. Поиск и фильтрация (FR-28, FR-29, FR-30)
- FR-28: Поиск пользователей по навыку
- FR-29: Фильтрация по уровню владения навыком

### 10.8. Аудит (FR-31)
- FR-31: Логирование действий пользователей

---

## 11. Группировка запросов в транзакции

> **Примечание:** Все транзакции вынесены в отдельный файл:
> `KnowledgeForKnowledgeLite/Scripts/03_transactions_postgresql.sql`
>
> См. файл для всех SQL транзакций, обеспечивающих атомарность операций и целостность данных.

Раздел включает следующие транзакции:

### 11.1. Транзакция регистрации пользователя
Атомарная операция создания аккаунта, профиля и логирования события регистрации.

### 11.2. Транзакция добавления навыка с документом
Атомарная операция добавления навыка пользователю, загрузки подтверждающего документа, создания запроса на верификацию и логирования.

### 11.3. Транзакция верификации документа администратором
Атомарная операция обновления статуса документа, верификации навыка (при одобрении), обновления запроса на верификацию и логирования.

### 11.4. Транзакция публикации поста с увеличением счетчика просмотров
Атомарная операция увеличения счетчика просмотров поста и логирования события просмотра.

### 11.5. Транзакция удаления пользователя (мягкое удаление)
Атомарная операция мягкого удаления аккаунта, деактивации профиля, закрытия всех активных постов пользователя и логирования.

### 11.6. Транзакция поиска партнеров для обмена знаниями
Атомарная операция поиска пользователей для обмена знаниями и логирования события поиска.

---

## 12. Заключение

В данной пояснительной записке представлена полная разработка системы обмена знаниями "KnowledgeForKnowledgeLite", предназначенной для студентов высших учебных заведений.

### 12.1. Основные достижения

1. **Проанализирована предметная область** и определены функциональные и нефункциональные требования к системе.

2. **Разработана нормализованная схема базы данных** до 4NF, что обеспечивает:
   - Отсутствие аномалий обновления, вставки и удаления
   - Минимальную избыточность данных
   - Целостность данных через внешние ключи и ограничения

3. **Определены функциональные и многозначные зависимости** между атрибутами сущностей.

4. **Создан SQL DDL скрипт** для реализации схемы базы данных со всеми ограничениями целостности.

5. **Разработаны SQL DML запросы** для реализации всех функциональных требований.

6. **Сгруппированы запросы в транзакции** для обеспечения атомарности операций и целостности данных.

### 12.2. Особенности системы

- **Гибкая система навыков** с категориями и уровнями владения
- **Верификация навыков** через документы с проверкой администраторами
- **Двусторонний обмен** предложений и запросов на помощь
- **Полный аудит действий** пользователей для безопасности
- **Мягкое удаление** для сохранения истории данных

### 12.3. Возможности для дальнейшего развития

1. Добавление системы рейтингов и отзывов пользователей
2. Реализация встроенной системы сообщений
3. Добавление календаря для планирования занятий
4. Интеграция с системами видеосвязи
5. Мобильное приложение для удобного доступа

Система готова к реализации и может быть использована студентами для взаимопомощи в обучении на основе принципа бартера знаний.

---

**Конец пояснительной записки**




