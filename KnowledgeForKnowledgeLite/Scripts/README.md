# SQL Скрипты для KnowledgeForKnowledgeLite

Эта папка содержит все SQL скрипты для работы с базой данных.

## Файлы

### 00_init_database.sql
**Полный DDL скрипт для создания базы данных**

- Создает базу данных `KnowledgeForKnowledgeLite`
- Создает все 12 таблиц с полными определениями (поля, типы, ограничения)
- Создает все индексы для оптимизации запросов
- Настраивает внешние ключи с правилами ON DELETE
- Добавляет CHECK-ограничения для валидации данных
- Заполняет справочные данные (категории навыков, уровни навыков, примеры навыков)

**Использование:**
```bash
mysql -u root -p < 00_init_database.sql
```

**Внимание:** Скрипт удаляет все существующие таблицы перед созданием! Используйте только для первоначальной установки.

---

### 01_create_database.sql
**Создание только базы данных**

Простой скрипт для создания пустой базы данных без таблиц. Используется редко, так как `00_init_database.sql` уже включает создание БД.

**Использование:**
```bash
mysql -u root -p < 01_create_database.sql
```

---

### 02_dml_queries.sql
**SQL DML запросы для всех функциональных требований**

Содержит примеры SELECT, INSERT, UPDATE, DELETE запросов, реализующих функциональные требования системы:

- **10.1.** Управление пользователями (FR-1, FR-2, FR-4, FR-5)
- **10.2.** Управление профилями (FR-6, FR-7, FR-8)
- **10.3.** Управление навыками (FR-9, FR-10, FR-11, FR-12, FR-13)
- **10.4.** Верификация навыков (FR-15, FR-16, FR-17, FR-18)
- **10.5.** Образование (FR-20)
- **10.6.** Публикация предложений и запросов (FR-21, FR-22, FR-23, FR-24)
- **10.7.** Поиск и фильтрация (FR-28, FR-29, FR-30)
- **10.8.** Аудит (FR-31)

**Использование:**
- Можно выполнять отдельные запросы для тестирования
- Используйте как справочник для понимания структуры запросов
- Запросы содержат подробные комментарии

**Примечание:** Значения в примерах нужно заменить на реальные данные.

---

### 03_transactions.sql
**Транзакции для критичных операций**

Содержит 6 транзакций, обеспечивающих атомарность операций:

1. **11.1.** Транзакция регистрации пользователя
   - Создание аккаунта, профиля и логирование в одной транзакции

2. **11.2.** Транзакция добавления навыка с документом
   - Добавление навыка, загрузка документа и создание запроса на верификацию

3. **11.3.** Транзакция верификации документа администратором
   - Верификация документа, обновление статуса навыка и запроса на верификацию

4. **11.4.** Транзакция публикации поста с увеличением счетчика просмотров
   - Увеличение счетчика и логирование просмотра

5. **11.5.** Транзакция удаления пользователя (мягкое удаление)
   - Мягкое удаление аккаунта, деактивация профиля и закрытие постов

6. **11.6.** Транзакция поиска партнеров для обмена знаниями
   - Поиск партнеров и логирование запроса

**Использование:**
- Выполняйте транзакции полностью (START TRANSACTION ... COMMIT)
- При ошибке используйте ROLLBACK
- Все транзакции используют переменные (@variable) - настройте значения перед выполнением

---

## Порядок выполнения

### Первоначальная установка:

```bash
# 1. Создание БД и всех таблиц
mysql -u root -p < 00_init_database.sql
```

### Тестирование запросов:

```bash
# Выполните отдельные запросы из 02_dml_queries.sql через MySQL клиент
mysql -u root -p KnowledgeForKnowledgeLite

# Затем скопируйте и выполните нужные запросы из файла
```

### Тестирование транзакций:

```bash
# Аналогично - выполните транзакции из 03_transactions.sql
mysql -u root -p KnowledgeForKnowledgeLite
```

---

## Примечания

- Все файлы содержат подробные комментарии
- SQL запросы оптимизированы для MySQL 8.0+
- Используется кодировка utf8mb4 для поддержки всех символов
- Все транзакции используют InnoDB engine для поддержки ACID

---

## Связь с документацией

Все SQL запросы также описаны в пояснительной записке:
- Раздел 9: SQL DDL скрипт
- Раздел 10: SQL DML запросы
- Раздел 11: Транзакции

Файлы в этой папке являются исполняемыми версиями запросов из пояснительной записки.

